#!/usr/bin/env python3
import pathlib
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import sys
import numpy as np
import scipy.stats
sys.path.append(".")
from stnet.utils.util import latexify

# Basic setup for figures
pathlib.Path("fig").mkdir(parents=True, exist_ok=True)
latexify()

#    Layers         Imagenet Random
models = [
    ("FC",          116, 53),
    ("FC+\n1 Conv",  91, 53),
    ("FC+\n2 Conv",  81, 53),
    ("FC+\n3 Conv",  95, 53),
    ("FC+\n4 Conv", 100, 53),
    ("FC+\n5 Conv", 102, 53),
]

label, rand, im = zip(*models)

fig = plt.figure(figsize=(3, 3))
# plt.scatter(range(len(label)), im, s=1, color="k")
# plt.scatter(range(len(label)), rand, s=1, color="blue")
plt.plot(range(len(label)), im,   marker=".", color="k")
plt.plot(range(len(label)), rand, marker=" ", color="blue", linestyle="--")
plt.legend(["ImageNet", "Random"], loc="best")
# plt.title("Transfer from ImageNet")
plt.xlabel("Layers Trained")
plt.ylabel("# Genes")
plt.ylim([0, 120])
ax = plt.gca()
ax.set_xticks(range(len(label)))
ax.set_xticklabels(label, fontsize=6)
plt.tight_layout()
plt.savefig("fig/finetune.pdf")
plt.close(fig)

genes = [
    ("IGLL5",  17/22, 15/23),
    ("RPLP1",  20/23, 16/23),
    ("TFF3",   12/23, 10/23),
    ("TMSB10", 21/23, 22/23),
    ("RPS18",  18/23, 20/23),
    ("GAPDH",  17/23, 15/23),
    ("CPB1",   17/23, 11/23),
    ("RPLP2",  22/23, 21/23),
    ("RPL37A", 18/23, 17/23),
    ("RPS14",  16/23, 19/23),
]


 
x = scipy.stats.fisher_exact([[178, 166],
                             [229 - 178, 230 - 166]])
print(x)
x = scipy.stats.fisher_exact([[179, 166],
                             [230 - 179, 230 - 166]])
print(x)

label, single_task, multi_task = zip(*genes)
print(sum(single_task))
print(sum(multi_task))

width = 1
space = 2
fig = plt.figure(figsize=(4, 2.5))
plt.bar((2 * width + space) * np.array(range(len(genes))) + width * 0, 23 * np.array(multi_task),  width=width, bottom=0,  label="Multi-task")
plt.bar((2 * width + space) * np.array(range(len(genes))) + width * 1, 23 * np.array(single_task), width=width, bottom=0, label="Individual")
ax = plt.gca()
plt.xticks((2 * width + space) * np.array(range(len(genes))) + 0.5 * width, label, rotation="vertical")
plt.yticks([0, 5, 10, 15, 20, 23])
plt.ylim([0, 28.0])
plt.xlabel("Gene")
plt.ylabel("# Consistent Patients")
plt.legend(loc="best")
plt.tight_layout()
plt.savefig("fig/multitask.pdf")
plt.close(fig)

cnn = [(0.09601619051264487, 16, 'RPS20'), (0.18258077396493275, 23, 'CD74'), (0.1697973854255662, 22, 'VIM'), (0.1120635791528371, 19, 'GRN'), (0.2642388574823857, 22, 'TMSB10'), (0.13556012498519593, 23, 'CYBA'), (0.15457290699369433, 20, 'PRSS8'), (0.14209915887138835, 19, 'SEC61A1'), (0.13109960920424077, 17, 'RPL18'), (0.18506567411296845, 18, 'PABPC1'), (0.16446509262081302, 19, 'RPL31'), (0.1342564322900435, 17, 'ATP6AP1'), (0.027066772509154492, 15, 'ENO1'), (0.17074353405464637, 20, 'ACTB'), (0.10297031107517396, 15, 'RPS5'), (0.22924956855383588, 21, 'FTL'), (0.3405226627405953, 23, 'GNAS'), (0.04347053418177352, 15, 'RPLP0'), (0.11663730785458273, 19, 'FXYD3'), (0.13333787814384251, 21, 'MYL6'), (0.2808855477292053, 23, 'HSP90AB1'), (0.2851303714289505, 21, 'XBP1'), (0.10625175196046346, 21, 'TSPO'), (0.09561366008223718, 16, 'RPL3'), (0.10726795802983936, 21, 'MYL9'), (0.19588053451446089, 15, 'CST3'), (0.16731949588460476, 22, 'TIMP1'), (0.08749315297253574, 17, 'ELOB'), (0.10457322932513351, 20, 'EEF1D'), (0.15482445670320874, 21, 'OAZ1'), (0.14836766065806437, 19, 'AES'), (0.12812534435870312, 16, 'RPS16'), (0.12799596793855036, 21, 'PLD3'), (0.11137128532692445, 16, 'RPS19'), (0.04664753574925798, 15, 'RPL18A'), (0.24951981469442044, 19, 'HSPB1'), (0.24630873856741656, 22, 'AEBP1'), (0.16056635969657718, 20, 'EDF1'), (0.11693819021119661, 18, 'RPL28'), (0.07270712183350647, 17, 'RPL19'), (0.14409338024189824, 21, 'PSMD3'), (0.21455116448790718, 19, 'PFN1'), (0.16320384361546955, 21, 'SYNGR2'), (0.3039951951892313, 22, 'DDX5'), (0.16266561242610897, 20, 'LGALS3BP'), (0.1973082216855733, 22, 'COL1A1'), (0.19064459648694895, 20, 'SLC9A3R1'), (0.11474357538188548, 19, 'RPL34'), (0.230523872450876, 19, 'CCND1'), (0.13806845846330104, 21, 'CD81'), (0.13445591057591305, 18, 'RPS13'), (0.06665377708034197, 17, 'KRT18'), (0.09682350656304418, 17, 'MGP'), (0.19219555438461283, 15, 'GAPDH'), (0.11639953246152329, 19, 'C12orf57'), (0.12904739330059817, 18, 'RPS12'), (0.19179986478347663, 20, 'SPARC'), (0.13556834401577095, 22, 'GNAI2'), (0.09559024931340245, 18, 'RPL24'), (0.13055411975818465, 20, 'EIF4G1'), (0.1407730023104783, 17, 'RPS15'), (0.2749503698092113, 22, 'FN1'), (0.1269956185974889, 21, 'IGFBP2'), (0.1431303252863334, 20, 'SDC1'), (0.1386226323202996, 19, 'ATP6V0B'), (0.16928784473716735, 20, 'PRDX1'), (0.19077781511477326, 21, 'CTSD'), (0.12224942665738527, 18, 'RPS25'), (-0.005386289153215547, 11, 'CLU'), (0.16230524806330157, 21, 'RPL5'), (0.07980813759154615, 18, 'PFDN5'), (0.22792001168329187, 21, 'TUBA1B'), (0.11661679668650439, 19, 'ATP5F1E'), (0.10056071631101465, 20, 'RPS10'), (0.14434606925142188, 19, 'SPDEF'), (0.07956927389529081, 17, 'PPDPF'), (0.10446732943081019, 20, 'RPL23'), (0.22002272639211834, 21, 'C3'), (0.10382407719766903, 18, 'COX6B1'), (0.06942542797198499, 16, 'IFI6'), (0.06552786755279229, 15, 'UQCR11'), (0.2421091299849231, 22, 'APOE'), (0.05162066694042599, 20, 'APOC1'), (0.05980146394611065, 15, 'RPL36'), (0.1293626480509494, 22, 'BST2'), (0.07102347945012343, 17, 'COX4I1'), (0.08652304879349101, 18, 'RPL27'), (0.24092502697590856, 23, 'H3F3B'), (0.13025103602475924, 19, 'EIF5A'), (0.22282965727774223, 21, 'TPT1'), (0.1766681141131152, 18, 'RPS15A'), (0.09842725997655191, 22, 'CD63'), (0.057159790843271996, 14, 'RPL35'), (0.18202004138711472, 18, 'RPS6'), (0.12491532550972191, 16, 'RPLP1'), (0.1429365168299147, 18, 'RPS24'), (0.15901868385384474, 18, 'SERF2'), (0.10060906432101838, 16, 'RPS2'), (0.134221590468573, 20, 'ARHGDIA'), (0.19127733823813048, 20, 'ERBB2'), (0.11151305957547519, 16, 'IFITM3'), (0.08632436003067064, 15, 'RPS11'), (0.11212735416938088, 14, 'RPL13A'), (0.14174030736414972, 23, 'SH3BGRL3'), (0.13312734463929998, 17, 'RPL11'), (0.08217850665208992, 16, 'RPS8'), (0.2147827352792936, 23, 'PTPRF'), (-0.04528768911229822, 6, 'S100A8'), (0.09696418948239102, 21, 'GUK1'), (0.21375384912067766, 18, 'RPS27A'), (0.1064623818263225, 17, 'NBEAL1'), (0.12652839810119285, 17, 'RPL32'), (0.11322387846698063, 17, 'RPS3A'), (0.18232955429555178, 17, 'RPL37'), (0.14207573833017723, 18, 'RPL10'), (0.07585473565107566, 18, 'RPL7'), (0.1108836870160886, 18, 'NDUFB9'), (0.12488111995137097, 17, 'RPL7A'), (0.14287566938863225, 19, 'RPS3'), (0.10982420789980585, 21, 'TAGLN'), (0.13206052202923127, 23, 'FAU'), (0.10413269527211091, 20, 'ALDOA'), (0.12775818353915558, 20, 'UBC'), (0.18275446526638925, 18, 'MZT2B'), (-0.03744500581223047, 11, 'CPB1'), (0.09772698308159114, 20, 'RHOC'), (0.1798542861069626, 16, 'RPL30'), (0.18327964686366038, 21, 'TAGLN2'), (-0.008148583563925513, 10, 'TFF3'), (0.02946989935984949, 12, 'TFF1'), (0.10538596029645181, 23, 'LMNA'), (0.07435133705544618, 17, 'AZGP1'), (0.09873354056014286, 19, 'LY6E'), (0.14505250058749358, 20, 'RPL8'), (0.19110175519421996, 23, 'EIF4A1'), (0.09868485125154333, 17, 'RPL29'), (0.1673480523961366, 23, 'LAPTM5'), (0.17143085357256016, 18, 'S100A11'), (0.03284639536257645, 15, 'S100A9'), (0.20297580243425553, 22, 'ATP1A1'), (0.08632096671464119, 20, 'ELF3'), (0.08539286422586036, 21, 'SSR2'), (0.23432742074095333, 19, 'RPL9'), (0.08296544815025246, 20, 'UQCRQ'), (0.11833240113733325, 19, 'RPS14'), (0.20331282697654032, 22, 'COL1A2'), (0.10717205046077828, 20, 'CTSB'), (0.17918287951489045, 22, 'COX6C'), (0.197075231658283, 19, 'CLDN3'), (0.059044872452256265, 20, 'IFI27'), (0.09486491837432812, 19, 'RPL27A'), (0.24214905932799902, 20, 'B2M'), (0.1350253810393369, 19, 'GPX4'), (0.03242121350843575, 15, 'RPL13'), (0.11394360567883721, 18, 'EEF2'), (0.07465097847046023, 17, 'PRDX2'), (0.1883899838804884, 21, 'BEST1'), (0.0986029864623027, 19, 'FTH1'), (0.11305689277613647, 19, 'SLC25A6'), (0.3099269201160749, 23, 'FASN'), (0.1254124332406689, 18, 'UBB'), (0.13303670001020318, 21, 'KRT8'), (0.10589427724120727, 17, 'RPS9'), (0.20698226241702017, 21, 'KRT19'), (0.11723121334301799, 17, 'RPS21'), (0.14402009352740613, 18, 'RPS7'), (0.14689709300101025, 18, 'BSG'), (0.17731797939884258, 18, 'GNB2'), (0.1859917247557171, 21, 'PPP1CA'), (0.05935765395472346, 18, 'CFL1'), (0.1062639750277005, 17, 'RPL38'), (0.15035164664303316, 18, 'MZT2A'), (0.0906584612936466, 21, 'C1QA'), (0.2195764243458717, 22, 'JUP'), (0.10584809680935986, 16, 'RPL4'), (0.1566644346835187, 19, 'RPL15'), (0.08061560994534926, 16, 'NDUFA11'), (0.1059049141807099, 22, 'A2M'), (0.11785599767984595, 18, 'COX8A'), (0.15923757750199694, 21, 'RPLP2'), (0.1350180734772293, 20, 'POLR2L'), (0.08914717315521022, 18, 'RPS27'), (-0.04115008708041496, 7, 'CALML5'), (0.16881945258140074, 19, 'GRINA'), (0.11176456133184605, 20, 'TUFM'), (0.098076535761864, 20, 'SELENOW'), (0.24763671032231216, 19, 'CALR'), (0.06292277962878814, 16, 'SSR4'), (0.20919129784935483, 22, 'BGN'), (0.20855895934460136, 18, 'RPS17'), (0.1840613368300345, 21, 'CRIP2'), (0.13670616582466735, 17, 'RPL35A'), (0.3276893706598022, 22, 'ACTG1'), (0.1353289818927338, 18, 'H1FX'), (0.005549937819763642, 13, 'MUC1'), (0.198719208382569, 18, 'P4HB'), (0.07527726011381411, 18, 'BCAP31'), (0.09505587498349738, 16, 'NDUFA13'), (0.17341409193059376, 20, 'RPS23'), (0.24887108407637804, 22, 'PTMA'), (0.04628846087772887, 16, 'ISG15'), (0.049232630539488204, 15, 'RPL14'), (0.1529803214094625, 20, 'EVL'), (0.21387227799335803, 22, 'PLXNB2'), (0.11891044028994113, 20, 'FLNA'), (0.20863253222979597, 23, 'PSAP'), (0.13181303293446878, 17, 'RPL37A'), (0.042668043164058145, 14, 'S100A6'), (0.15945459904308193, 19, 'RPL12'), (0.20133116180084534, 17, 'RPS4X'), (0.09709736624483996, 16, 'RPL23A'), (0.09444430727545898, 18, 'HIST2H2AA3'), (0.21623306025061015, 23, 'HLA-DRA'), (0.16542883652106025, 19, 'HLA-C'), (0.09649091779146177, 18, 'HLA-E'), (0.11249478135760409, 16, 'RACK1'), (0.11543314532467855, 20, 'TMSB4X'), (0.1110577900613452, 16, 'HLA-A'), (0.20259683004911086, 19, 'RPS29'), (0.09258430335906664, 17, 'ZNF90'), (0.10770285023395244, 19, 'STARD10'), (0.1442171687523405, 19, 'UBA52'), (0.1499229611121714, 18, 'C4B'), (0.16097315925669325, 20, 'RPS18'), (0.18177072369559255, 20, 'TAPBP'), (0.08646734723022052, 17, 'RPS28'), (0.2390311140877741, 23, 'GAS5'), (0.16786651632154598, 19, 'HLA-B'), (0.07455974948850444, 18, 'H2AFJ'), (0.06761515690257988, 17, 'MALAT1'), (0.102518334180846, 15, 'IGLL5'), (0.2798317533118817, 23, 'MTRNR2L8'), (0.12361235052667606, 18, 'SNHG25'), (0.22468293246847984, 23, 'MTRNR2L12'), (0.11764996384065449, 19, 'HIST2H2AA4'), (0.05580884120800077, 14, 'ENSG00000279274'), (0.12257151101628631, 18, 'ENSG00000279483'), (0.10995825881983487, 19, '__ambiguous[ENSG00000124614+ENSG00000270800]'), (0.1429709198022069, 20, '__ambiguous[ENSG00000177576+ENSG00000265681+ENSG00000215472]'), (0.1683505498895879, 20, '__ambiguous[ENSG00000185883+ENSG00000260272]'), (0.09565400296925973, 18, '__ambiguous[ENSG00000185885+ENSG00000185201]'), (0.07233246568766091, 15, '__ambiguous[ENSG00000219200+ENSG00000161939]'), (0.11532233172908356, 20, '__ambiguous[ENSG00000241343+ENSG00000257529]'), (0.13775971241968132, 19, '__ambiguous[ENSG00000243678+ENSG00000011052]'), (0.14701415570185158, 15, '__ambiguous[ENSG00000251357+ENSG00000240972]'), (0.06701310302401126, 17, '__ambiguous[ENSG00000254772+ENSG00000255508]'), (0.11240530228521943, 20, '__ambiguous[ENSG00000257341+ENSG00000213145]'), (0.060654758729574376, 17, '__ambiguous[ENSG00000262526+ENSG00000170296]'), (-0.024048843441421726, 10, '__ambiguous[ENSG00000273259+ENSG00000196136]'), (0.16751467968132425, 21, '__ambiguous[ENSG00000277957+ENSG00000161960]')]
feature = [(0.07246977090835571, 16, 'RPS20'), (0.10379260778427124, 21, 'CD74'), (0.09785392135381699, 18, 'VIM'), (0.041372641921043396, 17, 'GRN'), (0.0967315211892128, 18, 'TMSB10'), (0.09314074367284775, 19, 'CYBA'), (0.053985971957445145, 16, 'PRSS8'), (0.07400649040937424, 18, 'SEC61A1'), (0.025325963273644447, 14, 'RPL18'), (0.08511405438184738, 16, 'PABPC1'), (0.07226681709289551, 17, 'RPL31'), (0.06884100288152695, 17, 'ATP6AP1'), (0.03556828945875168, 17, 'ENO1'), (0.10431360453367233, 17, 'ACTB'), (0.053440894931554794, 15, 'RPS5'), (0.11410821974277496, 20, 'FTL'), (0.18047656118869781, 22, 'GNAS'), (0.004008177202194929, 12, 'RPLP0'), (0.02809348702430725, 13, 'FXYD3'), (0.07694059610366821, 19, 'MYL6'), (0.1821683794260025, 22, 'HSP90AB1'), (0.1450178623199463, 21, 'XBP1'), (0.05081712827086449, 16, 'TSPO'), (0.0663415715098381, 17, 'RPL3'), (0.09200293570756912, 21, 'MYL9'), (0.07271900773048401, 14, 'CST3'), (0.06971472501754761, 19, 'TIMP1'), (0.040816206485033035, 18, 'ELOB'), (0.0037264334969222546, 12, 'EEF1D'), (0.07941927760839462, 17, 'OAZ1'), (0.056706689298152924, 18, 'AES'), (0.01635766215622425, 15, 'RPS16'), (0.0757947489619255, 17, 'PLD3'), (0.050467438995838165, 14, 'RPS19'), (0.008633474819362164, 12, 'RPL18A'), (0.06729178130626678, 17, 'HSPB1'), (0.13520914316177368, 23, 'AEBP1'), (0.12058021128177643, 20, 'EDF1'), (0.08082493394613266, 16, 'RPL28'), (0.02554498240351677, 13, 'RPL19'), (0.05521039292216301, 15, 'PSMD3'), (0.16304650902748108, 17, 'PFN1'), (0.07912513613700867, 18, 'SYNGR2'), (0.25273117423057556, 22, 'DDX5'), (0.10104592144489288, 19, 'LGALS3BP'), (0.14941540360450745, 18, 'COL1A1'), (0.052300915122032166, 17, 'SLC9A3R1'), (0.06302881240844727, 15, 'RPL34'), (0.033222321420907974, 15, 'CCND1'), (0.09796739369630814, 18, 'CD81'), (0.039358917623758316, 17, 'RPS13'), (0.004202386364340782, 13, 'KRT18'), (0.00597490556538105, 13, 'MGP'), (0.11828815191984177, 17, 'GAPDH'), (0.03351430222392082, 18, 'C12orf57'), (0.05593461915850639, 17, 'RPS12'), (0.13599400222301483, 19, 'SPARC'), (0.08904340863227844, 16, 'GNAI2'), (0.06697482615709305, 15, 'RPL24'), (0.052775848656892776, 18, 'EIF4G1'), (0.07907267659902573, 15, 'RPS15'), (0.14088532328605652, 20, 'FN1'), (0.07100636512041092, 18, 'IGFBP2'), (0.06184111535549164, 19, 'SDC1'), (0.09272872656583786, 17, 'ATP6V0B'), (0.06872444599866867, 18, 'PRDX1'), (0.1498953402042389, 19, 'CTSD'), (0.0823194831609726, 16, 'RPS25'), (0.006265474483370781, 13, 'CLU'), (0.06361016631126404, 21, 'RPL5'), (0.02206999808549881, 13, 'PFDN5'), (0.11283975839614868, 20, 'TUBA1B'), (0.07065515220165253, 18, 'ATP5F1E'), (0.03569391742348671, 18, 'RPS10'), (0.11930451542139053, 17, 'SPDEF'), (0.0246741846203804, 18, 'PPDPF'), (0.028459960594773293, 15, 'RPL23'), (0.055401142686605453, 21, 'C3'), (0.057017166167497635, 18, 'COX6B1'), (0.03855152055621147, 14, 'IFI6'), (0.038986630737781525, 16, 'UQCR11'), (0.16221041977405548, 18, 'APOE'), (0.0481257326900959, 18, 'APOC1'), (0.046845316886901855, 15, 'RPL36'), (0.06791212409734726, 18, 'BST2'), (0.04368777200579643, 17, 'COX4I1'), (0.05182487517595291, 14, 'RPL27'), (0.14757812023162842, 21, 'H3F3B'), (0.03688349202275276, 19, 'EIF5A'), (0.09032763540744781, 17, 'TPT1'), (0.05340998247265816, 19, 'RPS15A'), (0.02333400771021843, 16, 'CD63'), (0.017210116609930992, 12, 'RPL35'), (0.10886726528406143, 16, 'RPS6'), (0.06270815432071686, 17, 'RPLP1'), (0.10202755033969879, 15, 'RPS24'), (0.08644168078899384, 18, 'SERF2'), (0.07966604083776474, 15, 'RPS2'), (0.04504069313406944, 17, 'ARHGDIA'), (0.10594329237937927, 17, 'ERBB2'), (0.05252046510577202, 18, 'IFITM3'), (0.07577187567949295, 15, 'RPS11'), (0.04508991539478302, 15, 'RPL13A'), (0.0873694196343422, 18, 'SH3BGRL3'), (0.04471193626523018, 17, 'RPL11'), (0.06100977584719658, 15, 'RPS8'), (0.09940770268440247, 22, 'PTPRF'), (-0.008232195861637592, 11, 'S100A8'), (0.041470494121313095, 17, 'GUK1'), (0.024292871356010437, 15, 'RPS27A'), (0.043480195105075836, 17, 'NBEAL1'), (0.05016413331031799, 17, 'RPL32'), (0.04270067438483238, 15, 'RPS3A'), (0.05870305746793747, 16, 'RPL37'), (0.08013585209846497, 16, 'RPL10'), (0.037058595567941666, 17, 'RPL7'), (0.07269007712602615, 19, 'NDUFB9'), (0.04869788885116577, 16, 'RPL7A'), (0.04658637195825577, 15, 'RPS3'), (0.11170824617147446, 21, 'TAGLN'), (0.051283229142427444, 16, 'FAU'), (0.0548214390873909, 18, 'ALDOA'), (0.034772783517837524, 16, 'UBC'), (0.0386287160217762, 17, 'MZT2B'), (0.0076686623506248, 13, 'CPB1'), (0.040457356721162796, 17, 'RHOC'), (0.06223949417471886, 16, 'RPL30'), (0.07315526157617569, 19, 'TAGLN2'), (0.011694182641804218, 15, 'TFF3'), (-0.012050265446305275, 11, 'TFF1'), (0.08970428258180618, 20, 'LMNA'), (0.01945212110877037, 16, 'AZGP1'), (0.04469926655292511, 16, 'LY6E'), (0.09450086206197739, 17, 'RPL8'), (0.12416286021471024, 20, 'EIF4A1'), (0.033602409064769745, 17, 'RPL29'), (0.09429272264242172, 19, 'LAPTM5'), (0.10817467421293259, 17, 'S100A11'), (0.012362649664282799, 14, 'S100A9'), (0.12049422413110733, 20, 'ATP1A1'), (0.055715128779411316, 20, 'ELF3'), (0.062084946781396866, 18, 'SSR2'), (0.10569790005683899, 19, 'RPL9'), (0.05104516074061394, 18, 'UQCRQ'), (0.0207577645778656, 14, 'RPS14'), (0.13234300911426544, 19, 'COL1A2'), (0.05221795290708542, 20, 'CTSB'), (0.07725045830011368, 19, 'COX6C'), (0.1347568929195404, 19, 'CLDN3'), (0.03667581453919411, 14, 'IFI27'), (0.037604235112667084, 18, 'RPL27A'), (0.1265932321548462, 16, 'B2M'), (0.07017780095338821, 17, 'GPX4'), (0.03578019142150879, 14, 'RPL13'), (0.05466606095433235, 17, 'EEF2'), (0.04763411357998848, 18, 'PRDX2'), (0.1487681269645691, 18, 'BEST1'), (0.05496736988425255, 17, 'FTH1'), (0.054661400616168976, 17, 'SLC25A6'), (0.15033601224422455, 18, 'FASN'), (0.062365107238292694, 18, 'UBB'), (0.07260265946388245, 18, 'KRT8'), (0.060874756425619125, 17, 'RPS9'), (0.04018699750304222, 16, 'KRT19'), (0.03205852583050728, 15, 'RPS21'), (0.046011026948690414, 16, 'RPS7'), (0.027333341538906097, 16, 'BSG'), (0.07322514057159424, 18, 'GNB2'), (0.05494420975446701, 20, 'PPP1CA'), (0.05572022125124931, 15, 'CFL1'), (0.07069367915391922, 16, 'RPL38'), (0.058001067489385605, 15, 'MZT2A'), (0.05320649966597557, 16, 'C1QA'), (0.08061662316322327, 18, 'JUP'), (0.03727350011467934, 16, 'RPL4'), (0.06627774983644485, 20, 'RPL15'), (0.012544538825750351, 13, 'NDUFA11'), (0.05612630769610405, 18, 'A2M'), (0.04034718871116638, 17, 'COX8A'), (0.10190241038799286, 16, 'RPLP2'), (0.05132979899644852, 19, 'POLR2L'), (0.06994251906871796, 14, 'RPS27'), (-0.03697875142097473, 8, 'CALML5'), (0.050830159336328506, 15, 'GRINA'), (0.035804640501737595, 14, 'TUFM'), (0.07633090019226074, 19, 'SELENOW'), (0.09522999823093414, 17, 'CALR'), (0.06144807115197182, 16, 'SSR4'), (0.14373263716697693, 21, 'BGN'), (0.0915469080209732, 15, 'RPS17'), (0.08891555666923523, 18, 'CRIP2'), (0.045189302414655685, 14, 'RPL35A'), (0.17644080519676208, 19, 'ACTG1'), (0.06993381679058075, 18, 'H1FX'), (-0.011479286476969719, 10, 'MUC1'), (0.10898875445127487, 17, 'P4HB'), (0.06991229951381683, 14, 'BCAP31'), (0.03896212577819824, 15, 'NDUFA13'), (0.05719586834311485, 17, 'RPS23'), (0.16384896636009216, 22, 'PTMA'), (-0.0035010373685508966, 11, 'ISG15'), (0.05127882584929466, 15, 'RPL14'), (0.046508900821208954, 17, 'EVL'), (0.12151797860860825, 20, 'PLXNB2'), (0.06352455914020538, 18, 'FLNA'), (0.1456659436225891, 21, 'PSAP'), (0.05624735355377197, 16, 'RPL37A'), (0.02419123984873295, 14, 'S100A6'), (0.07812152057886124, 15, 'RPL12'), (0.07302671670913696, 17, 'RPS4X'), (0.05385933816432953, 17, 'RPL23A'), (0.0069900876842439175, 15, 'HIST2H2AA3'), (0.0776480957865715, 20, 'HLA-DRA'), (0.10710709542036057, 16, 'HLA-C'), (0.0631144642829895, 16, 'HLA-E'), (0.016776951029896736, 13, 'RACK1'), (0.06560248136520386, 17, 'TMSB4X'), (0.07392160594463348, 14, 'HLA-A'), (0.11667724698781967, 18, 'RPS29'), (0.023757027462124825, 15, 'ZNF90'), (0.04860639572143555, 16, 'STARD10'), (0.06335962563753128, 17, 'UBA52'), (0.051053084433078766, 16, 'C4B'), (0.06894411891698837, 18, 'RPS18'), (0.13263314962387085, 20, 'TAPBP'), (0.049911018460989, 14, 'RPS28'), (0.10939421504735947, 21, 'GAS5'), (0.05190415307879448, 15, 'HLA-B'), (0.03564031049609184, 17, 'H2AFJ'), (0.026732148602604866, 17, 'MALAT1'), (-0.03177378699183464, 7, 'IGLL5'), (0.19278183579444885, 22, 'MTRNR2L8'), (0.04421624168753624, 16, 'SNHG25'), (0.26167017221450806, 22, 'MTRNR2L12'), (0.0287907887250185, 16, 'HIST2H2AA4'), (0.0693170577287674, 19, 'ENSG00000279274'), (0.02596547268331051, 14, 'ENSG00000279483'), (0.04097846895456314, 17, '__ambiguous[ENSG00000124614+ENSG00000270800]'), (0.06315015256404877, 20, '__ambiguous[ENSG00000177576+ENSG00000265681+ENSG00000215472]'), (0.08417433500289917, 18, '__ambiguous[ENSG00000185883+ENSG00000260272]'), (0.046931810677051544, 18, '__ambiguous[ENSG00000185885+ENSG00000185201]'), (0.03193286806344986, 13, '__ambiguous[ENSG00000219200+ENSG00000161939]'), (0.0589614063501358, 17, '__ambiguous[ENSG00000241343+ENSG00000257529]'), (0.09608322381973267, 20, '__ambiguous[ENSG00000243678+ENSG00000011052]'), (0.04235151782631874, 16, '__ambiguous[ENSG00000251357+ENSG00000240972]'), (0.036152828484773636, 15, '__ambiguous[ENSG00000254772+ENSG00000255508]'), (0.049586616456508636, 17, '__ambiguous[ENSG00000257341+ENSG00000213145]'), (0.0451488122344017, 17, '__ambiguous[ENSG00000262526+ENSG00000170296]'), (0.022686487063765526, 14, '__ambiguous[ENSG00000273259+ENSG00000196136]'), (0.11015453934669495, 17, '__ambiguous[ENSG00000277957+ENSG00000161960]')]

pathologist = [(0.05609105708815745, 13, 'RPS20'), (-0.03483070049423579, 7, 'CD74'), (-0.010644860884478049, 10, 'VIM'), (0.0062733704801694115, 12, 'GRN'), (0.1134988594825905, 15, 'TMSB10'), (0.008834280774612473, 13, 'CYBA'), (0.12421968209666859, 19, 'PRSS8'), (0.07901175528954585, 14, 'SEC61A1'), (0.06895588399252608, 12, 'RPL18'), (0.15690425847794803, 18, 'PABPC1'), (0.0529571792762046, 17, 'RPL31'), (0.07048788715048804, 15, 'ATP6AP1'), (0.0206189719009739, 13, 'ENO1'), (0.08529553138394286, 15, 'ACTB'), (0.02174147344477929, 11, 'RPS5'), (0.04553397225569296, 13, 'FTL'), (0.2239617347220288, 21, 'GNAS'), (-0.026569932661769047, 8, 'RPLP0'), (0.06288592376201127, 16, 'FXYD3'), (0.0488697667671766, 13, 'MYL6'), (0.2200864116966427, 21, 'HSP90AB1'), (0.2307428049826762, 18, 'XBP1'), (0.035527695160159314, 13, 'TSPO'), (-0.017772809183485252, 10, 'RPL3'), (0.048177990105950155, 11, 'MYL9'), (-0.0054176747239663234, 10, 'CST3'), (-0.00833437968089121, 9, 'TIMP1'), (0.015480043670292735, 12, 'ELOB'), (0.016448170452950814, 12, 'EEF1D'), (0.0907596134404763, 16, 'OAZ1'), (0.04274678345199537, 16, 'AES'), (0.05181671616547212, 12, 'RPS16'), (0.03302453176502697, 13, 'PLD3'), (-0.035713880949442126, 8, 'RPS19'), (-0.04985983497488331, 8, 'RPL18A'), (0.18476803317590032, 18, 'HSPB1'), (0.021941702050616744, 11, 'AEBP1'), (0.08833096042542798, 15, 'EDF1'), (0.004855306431326194, 11, 'RPL28'), (0.018341522480172574, 13, 'RPL19'), (0.1221935858614883, 18, 'PSMD3'), (0.10444090267387648, 14, 'PFN1'), (0.09020084318490268, 16, 'SYNGR2'), (0.18750359990135407, 21, 'DDX5'), (0.05492385042006638, 14, 'LGALS3BP'), (-0.13633981442701248, 8, 'COL1A1'), (0.1619824627849157, 15, 'SLC9A3R1'), (0.061836836646120906, 15, 'RPL34'), (0.111531071944801, 17, 'CCND1'), (0.010242305736047133, 11, 'CD81'), (0.0436206167983282, 17, 'RPS13'), (0.08441302246830439, 15, 'KRT18'), (-0.016130943463996048, 10, 'MGP'), (0.10391127072325641, 14, 'GAPDH'), (0.011490015194030713, 12, 'C12orf57'), (0.04607683193289456, 16, 'RPS12'), (0.08945059124521258, 13, 'SPARC'), (0.02798428931513908, 14, 'GNAI2'), (0.009799564423073467, 11, 'RPL24'), (0.052206323063819164, 15, 'EIF4G1'), (0.05102831050121685, 13, 'RPS15'), (0.20734389952596777, 17, 'FN1'), (0.08714183082452759, 14, 'IGFBP2'), (-0.07757280089199693, 7, 'SDC1'), (0.08320706839897357, 16, 'ATP6V0B'), (0.11987256091911733, 17, 'PRDX1'), (-0.009891537741419003, 10, 'CTSD'), (0.003748166443663844, 11, 'RPS25'), (-0.04355718275433157, 6, 'CLU'), (0.12657095030259483, 20, 'RPL5'), (0.020693186385930155, 14, 'PFDN5'), (0.13616882072042272, 21, 'TUBA1B'), (0.09068136911822186, 17, 'ATP5F1E'), (-0.005193051778622842, 10, 'RPS10'), (0.12461096943759148, 17, 'SPDEF'), (0.056284958376001074, 15, 'PPDPF'), (0.05783101357485241, 13, 'RPL23'), (0.08932766432260048, 18, 'C3'), (0.05472701318471494, 15, 'COX6B1'), (0.05829456443311737, 13, 'IFI6'), (0.054908880616244236, 12, 'UQCR11'), (0.058556670137634596, 13, 'APOE'), (-0.012123880845157834, 8, 'APOC1'), (-0.0002770608298893579, 10, 'RPL36'), (0.030110213827951003, 13, 'BST2'), (0.01152623332221381, 12, 'COX4I1'), (-0.0018605895946529913, 10, 'RPL27'), (0.1712826014693094, 21, 'H3F3B'), (0.04780838389394096, 13, 'EIF5A'), (0.16449865841192932, 19, 'TPT1'), (0.0634932002352902, 15, 'RPS15A'), (0.051273588412733204, 13, 'CD63'), (-0.04371387428797546, 5, 'RPL35'), (0.04751975357252745, 13, 'RPS6'), (-0.07507872556767504, 8, 'RPLP1'), (0.1357324769725795, 19, 'RPS24'), (0.12506966214317428, 14, 'SERF2'), (0.06015335412847132, 13, 'RPS2'), (0.06240993476008819, 17, 'ARHGDIA'), (0.18412798594941493, 20, 'ERBB2'), (0.017882080708322142, 12, 'IFITM3'), (-0.013111586131016782, 6, 'RPS11'), (-0.03124987345417872, 9, 'RPL13A'), (0.011134885809924257, 11, 'SH3BGRL3'), (0.019749047094603914, 13, 'RPL11'), (0.08468311942576605, 13, 'RPS8'), (0.18357896777162636, 21, 'PTPRF'), (0.020670431172077404, 12, 'S100A8'), (0.03769276277762077, 12, 'GUK1'), (0.06563999211126086, 18, 'RPS27A'), (0.07682036685091748, 14, 'NBEAL1'), (0.03815426233772895, 11, 'RPL32'), (0.017484445471194144, 12, 'RPS3A'), (0.06815868087379906, 15, 'RPL37'), (0.04351223237289337, 15, 'RPL10'), (0.02547692091937926, 13, 'RPL7'), (0.04939684998692082, 14, 'NDUFB9'), (0.07576341803303212, 15, 'RPL7A'), (0.03762933794500597, 13, 'RPS3'), (0.033332986670345725, 13, 'TAGLN'), (-0.04146635161359214, 9, 'FAU'), (0.057330341323499595, 14, 'ALDOA'), (0.07092309742849358, 17, 'UBC'), (0.10659829784438739, 15, 'MZT2B'), (-0.01634632008970437, 8, 'CPB1'), (0.036412723650399235, 16, 'RHOC'), (0.01966965472413221, 12, 'RPL30'), (0.097576786078805, 17, 'TAGLN2'), (0.03670704458902536, 12, 'TFF3'), (0.015852287816490503, 12, 'TFF1'), (0.005421738671209018, 12, 'LMNA'), (0.05038946872021509, 14, 'AZGP1'), (0.04391655305058044, 13, 'LY6E'), (0.035251980090451614, 11, 'RPL8'), (0.10830837028286658, 19, 'EIF4A1'), (0.004427835322455646, 11, 'RPL29'), (-0.08725479080303716, 5, 'LAPTM5'), (0.14996707374782792, 19, 'S100A11'), (0.0709569476145028, 17, 'S100A9'), (0.19545662566373598, 21, 'ATP1A1'), (0.0724949772601099, 17, 'ELF3'), (0.05752634358660387, 16, 'SSR2'), (0.13748362909791273, 17, 'RPL9'), (0.09780776582374279, 13, 'UQCRQ'), (-0.03212632210191311, 9, 'RPS14'), (0.14673487294495766, 14, 'COL1A2'), (0.01968587448362717, 11, 'CTSB'), (0.15251824718809343, 21, 'COX6C'), (0.10553883270528708, 18, 'CLDN3'), (3.922960285945152e-05, 11, 'IFI27'), (-0.017684631078644448, 8, 'RPL27A'), (0.15388134019146607, 19, 'B2M'), (0.02925549204661721, 13, 'GPX4'), (-0.02965287972088427, 7, 'RPL13'), (0.07034108465007713, 16, 'EEF2'), (0.059917588218453506, 15, 'PRDX2'), (0.08989893116050501, 13, 'BEST1'), (0.07908895834987223, 15, 'FTH1'), (0.018809451439830344, 16, 'SLC25A6'), (0.30791440582167456, 21, 'FASN'), (0.10043261464563184, 16, 'UBB'), (0.10246636328369409, 18, 'KRT8'), (-0.04392509286976415, 6, 'RPS9'), (0.16541911014204577, 17, 'KRT19'), (0.034222170528000154, 13, 'RPS21'), (0.03874583082345547, 16, 'RPS7'), (0.06323804747703364, 15, 'BSG'), (0.09416915726430942, 15, 'GNB2'), (0.0684847597689134, 14, 'PPP1CA'), (0.05284090400222189, 14, 'CFL1'), (0.03954507342846588, 14, 'RPL38'), (0.06293449305736712, 16, 'MZT2A'), (0.018599638452938095, 13, 'C1QA'), (0.16106015388043404, 17, 'JUP'), (0.03881618596788279, 15, 'RPL4'), (0.12135772884435411, 16, 'RPL15'), (0.01462832121576325, 13, 'NDUFA11'), (0.033130446111615156, 14, 'A2M'), (0.016472166285128646, 11, 'COX8A'), (0.004163276508698364, 11, 'RPLP2'), (0.04357051777056322, 14, 'POLR2L'), (-0.034365838823478156, 10, 'RPS27'), (-0.08812264178901358, 5, 'CALML5'), (0.08630185386246429, 14, 'GRINA'), (0.03041504819965077, 16, 'TUFM'), (0.06536957623739131, 17, 'SELENOW'), (0.11742420448735624, 17, 'CALR'), (0.009225546957663755, 11, 'SSR4'), (0.014326665286163769, 11, 'BGN'), (0.06232991608433025, 14, 'RPS17'), (0.11343119733868505, 19, 'CRIP2'), (0.05650745449269738, 13, 'RPL35A'), (0.2540375977384179, 21, 'ACTG1'), (0.060827798714782146, 14, 'H1FX'), (-0.08695590041508776, 5, 'MUC1'), (0.1178286404683404, 19, 'P4HB'), (0.03645505571008378, 14, 'BCAP31'), (0.014015829301277344, 12, 'NDUFA13'), (0.07261192032326112, 15, 'RPS23'), (0.19161050466386126, 21, 'PTMA'), (-0.04750126022716378, 8, 'ISG15'), (-0.009246778159943321, 10, 'RPL14'), (0.16405185193999233, 16, 'EVL'), (0.11254923922367976, 19, 'PLXNB2'), (0.011010425901999028, 11, 'FLNA'), (0.03257670837832806, 14, 'PSAP'), (0.053116711264284515, 13, 'RPL37A'), (-0.017808198511748793, 7, 'S100A6'), (0.08292456017223364, 15, 'RPL12'), (0.07994075246059833, 17, 'RPS4X'), (0.0037080142086885785, 11, 'RPL23A'), (0.06305543285170465, 16, 'HIST2H2AA3'), (0.034276914891738564, 14, 'HLA-DRA'), (0.07170739864225192, 14, 'HLA-C'), (0.0291152458952366, 13, 'HLA-E'), (0.04575875921070142, 13, 'RACK1'), (0.05174428389355041, 15, 'TMSB4X'), (0.00414576908116334, 11, 'HLA-A'), (0.030668609612671545, 12, 'RPS29'), (0.03249857102959314, 12, 'ZNF90'), (0.07387144423073976, 13, 'STARD10'), (0.06211122141865123, 12, 'UBA52'), (-0.062150476638382975, 9, 'C4B'), (0.006228423213983296, 11, 'RPS18'), (0.07528700291613834, 14, 'TAPBP'), (0.03610916647122572, 12, 'RPS28'), (0.12738611488444673, 21, 'GAS5'), (0.07958371320210689, 14, 'HLA-B'), (0.015590621330825753, 12, 'H2AFJ'), (0.0634827809614644, 14, 'MALAT1'), (0.0498052466939594, 12, 'IGLL5'), (0.09256594240211033, 18, 'MTRNR2L8'), (0.0778048570393895, 19, 'SNHG25'), (0.10967726580710915, 18, 'MTRNR2L12'), (0.08003917076696761, 15, 'HIST2H2AA4'), (0.0572305457518006, 14, 'ENSG00000279274'), (0.037923306972450006, 12, 'ENSG00000279483'), (0.008279336662745435, 11, '__ambiguous[ENSG00000124614+ENSG00000270800]'), (0.1124529373392552, 21, '__ambiguous[ENSG00000177576+ENSG00000265681+ENSG00000215472]'), (0.0662611891468392, 16, '__ambiguous[ENSG00000185883+ENSG00000260272]'), (-0.01744022824041119, 10, '__ambiguous[ENSG00000185885+ENSG00000185201]'), (-0.013408723322331055, 9, '__ambiguous[ENSG00000219200+ENSG00000161939]'), (0.06357839715741626, 17, '__ambiguous[ENSG00000241343+ENSG00000257529]'), (0.07990905738712682, 16, '__ambiguous[ENSG00000243678+ENSG00000011052]'), (0.037270270313420444, 12, '__ambiguous[ENSG00000251357+ENSG00000240972]'), (-0.0067437057793681265, 10, '__ambiguous[ENSG00000254772+ENSG00000255508]'), (0.05450577864645031, 13, '__ambiguous[ENSG00000257341+ENSG00000213145]'), (-0.020642189406698003, 10, '__ambiguous[ENSG00000262526+ENSG00000170296]'), (0.03750227775831543, 14, '__ambiguous[ENSG00000273259+ENSG00000196136]'), (0.06193682326297657, 17, '__ambiguous[ENSG00000277957+ENSG00000161960]')]

cnn = list(zip(*cnn))[0]
feature = list(zip(*feature))[0]
pathologist = list(zip(*pathologist))[0]

l = min(min(cnn), min(feature), min(pathologist))
h = max(max(cnn), max(feature), max(pathologist))
print(l, h)
l = -0.15
h = 0.35

fig = plt.figure(figsize=(1.93, 1.93))
plt.scatter(feature, cnn, marker=".", color="k", s=1)
plt.plot([l, h], [l, h], "--", color="k", linewidth=1)
plt.xlabel("Feature Corr.")
plt.ylabel("ST-Net Corr.")
plt.axis([l, h, l, h])
plt.axis("equal")
plt.tight_layout()
plt.savefig("fig/cnn_feature.pdf")
plt.close(fig)
print(sum(np.array(cnn) >= np.array(feature)))

fig = plt.figure(figsize=(1.93, 1.93))
plt.scatter(pathologist, cnn, marker=".", color="k", s=1)
plt.plot([l, h], [l, h], "--", color="k", linewidth=1)
plt.xlabel("Tumor/Norm Corr.")
plt.ylabel("ST-Net Corr.")
plt.axis([l, h, l, h])
plt.axis("equal")
print(plt.axis())
plt.tight_layout()
plt.savefig("fig/cnn_tumor.pdf")
plt.close(fig)
print(sum(np.array(cnn) >= np.array(pathologist)))
